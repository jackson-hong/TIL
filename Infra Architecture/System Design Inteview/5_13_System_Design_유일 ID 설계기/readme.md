# 5/13 System Design - 유일 ID 설계기

Date: May 13, 2022 11:24 PM

## 분산 시스템을 위한 유일 ID 생성기 설계

- 데이터 베이스가 분산되어 있는 경우 user_id를 생성한다고 가정했을 때 유일한 ID 생성기가 필요하다.
- 언급된 조건
    - ID는 유일할 것
    - 숫자로만 구성
    - 64비트로 표현될 수 있는 값
    - 발급 날짜에 따라 정렬 가능
    - 초당 10,000개의 ID를 만들 수 있음
- 선택지
    - 다중 마스터 복제
    - UUID
    - 티켓 서버
    - 트위터 스노플레이크 접근법

### 다중 마스터 복제

- DB의 auto_increment 기능을 활용하고 ID값은 데이터베이스 서버의 수만큼 증가시킨다.
- 단점
    - 여러 데이터 센터에 걸쳐 규모를 늘리기 어렵다
    - ID 유일성은 보장되지만 그 값이 시간 흐름에 맞추어 커지도록 보장할 수 없다.
    - 서버를 추가하거나 삭제할 때도 잘 동작하도록 만들기 어려움

### UUID(Universally Unique Identifier)

- 장점
    - UUID를 만드는 것은 단순하고 동기화 이슈도 없다
    - 규모의 확장도 쉽다
- 단점
    - 128비트로 요구사항에 비해 길다
    - 시간순 정렬 불가
    - 숫자가 아닌 값이 포함될 수 있음

### 티켓서버

- auto_increment 기능을 갖춘 DB 서버, 즉 티켓 서버를 중앙 집중형으로 하나만 사용하는 것
- 장점
    - 유일성이 보장된다
    - 구현하기 쉽고, 중소 규모 애플리케이션에 적합
- 단점
    - 티켓 서버가 SPOF가 된다.
    - 다중화를 할 경우 데이터 동기화 같은 새로운 문제 발생

### 트위터 스노플레이크 접근법

- 생성해야 하는 ID의 구조를 여러 Section으로 분할하는 것
- 예시
    - 사인 비트 - 1비트 할당, 나중에 쓰일 수 있고, 음수 양수 구별
    - 타임 스탬프 - 41비트 할당, 기원 시각 이후로 몇 밀리초가 경과했는지 나타냄
    - 데이터 센터 ID - 5비트 할당 2^5=32개 데이터 센터 지원
    - 서버 ID - 5비트 할당 데이터센터당 32개 서버를 사용할 수 있음
    - 일련 번호 - 12비트 할당, 각 서버에서 ID를 생성할 때마다 일련 번호를 1만큼 증가

### 추가 논의 가능 사항

- 시계 동기화 - 서버가 여러 코어에서 실행될 경우 같은 시계를 사용하지 않을 수 있다
- 각 절의 최적화 - 애플리케이션의 특성에 따라 절의 길이를 줄이거나 타임스탬프 절의 길이를 늘리는 것이 효과적일 수 있다