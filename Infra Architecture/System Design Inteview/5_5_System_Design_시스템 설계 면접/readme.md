# 5/5 System Design - 시스템 설계 면접

Date: May 5, 2022 11:11 AM

### 데이터베이스 규모 확장

저장할 데이터가 많아지면 DB에 대한 부하도 증가한다.

- 수직적확장
    - 기존 서버에 고성능 자원을 증성하는 방법
    - 하드웨어에는 한계가 있으므로 무한 증설은 불가능하다.
    - SPOF로 인한 위험성이 크다
    - 비용이 많이 든다.
- 수평적확장
    - DB의 수평적 확장은 샤딩(sharding)이라고도 한다.
    - 모든 샤드는 같은 스키마를 쓰지만 샤드에 보관도니느 데이터 사이에는 중복이 없다.
    - 예를 들어 user_id % 4 를 해시 함수로 사용하여 결과가 0이면 0번 샤드, 1이면 1번 샤드에 보관하는 방식
    - 해결해야 할 문제
        - 데이터 재 샤딩(resharding)
            - 데이터가 너무 많아져서 하나의 샤드로는 감당하기 어려울 때
            - 샤드 간 데이터 분포가 균등하지 못하여 하나의 샤드가 공간소모가 빨리 진행될 때
        - 유명인사(celebrity) 문제
            - 핫스팟 키 문제라고도 불리며 특정 샤드에 질의가 집중되는 경우 과부하가 걸리는 문제
            - 예를 들어 하나의 샤드에 유명인사의 데이터가 저장된 경우 그 샤드로 질의가 몰리는 경우
        - 조인과 비 정규화
            - 샤드 서버로 쪼개고 나면 데이터를 조인하기가 힘들어진다.
            - 비정규화가 하나의 방법이다
    
    ### 시스템 규모 확장을 위한 기법 정리
    
    - 웹 계층은 무상태 계층으로
    - 모든 계층에서 다중화 도입
    - 가능한 한 많은 데이터를 캐시할 것
    - 여러 데이터 센터를 지원할 것
    - 정적 콘텐츠는 CDN을 통해 서비스할 것
    - 데이터 계층은 샤딩을 통해 그 규모를 확장할 것
    - 각 계층은 독립적 서비스로 분할할 것
    - 시스템을 지속적으로 모니터링하고, 자동화 도구들을 활용할 것

### 시스템 설계 면접

- 직원자가 협력에 적합한 사람인지, 압박이 심한 상황도 잘 헤쳐나갈 수 있는지, 모호한 문제를 건설적으로 해결할 능력이 있는지 살펴볼 수 있다.
- 부정적 신호 - 설계에 순수성에 집착한 나머지 타협적 결정을 도외시하고 과도한 엔지니어링을 하는 경우
- 4단계 접근법
    1. 문제 이해 및 설계 범위 확정
        - 생각 없이 바로 답을 내지 말것 - 면접은 퀴즈쇼가 아니고, 정답 따위는 없다.
        - 요구사항을 정확히 이해하는 데 필요한 질문을 하라.
            - 구체적인 기능
            - 제품 사용자 수
            - 회사 규모는 얼마나 커질것이라 생각하는지
            - 회사의 기술 스택과, 설계 단순화를 위해 활용가능한 기존 서비스
    2. 개략적인 설계안 제시 및 동의 구하기
        - 최초 청사진을 제시하고 의견을 구하라 마치 팀원처럼
        - 화이트보드나 종이에 다이어그램을 그려라
        - 최초 설계안이 제약사항을 만족시키는 개략적으로 계산하고 설명할 것
    3. 상세 설계
        - 설계 대상 컴포넌트 사이에 우선순위를 정하거나
        - 특정 시스템에 대한 성능적 특성이나 세부사항을 깊게 설명해보는 것
    4. 마무리
        - 병목 구간이나 개선 가능한 지점을 찾아내 설명하기
        - 다시 한번 설계를 요약해본다
        - 오류 발생시 어떤 일이 생기는지도 확인해볼 것
        - 운영 이슈도 논의할 가치가 충분하다 - 로그, 메트릭스, 자동 배포툴
        - 미래에 닥칠 규모 확장 요구에 대한 대처
- 해야 할 것
    - 질문을 통해 확인하라, 스스로 내린 가정이 옳다 믿고 진행하지 말 것
    - 문제의 요구사항 이해
    - 정답이나 최선의 답안 같은 것은 없다.
    - 나의 사고 흐름을 이해시킬 것
    - 여러 해법을 함께 제시할 것
    - 개략적 설계에 면접관이 동의하면, 각 컴포넌트의 세부사항을 설명할 것
    - 면접관의 아이디어를 이끌어 낼 것
    - **포기하지 말라.**
- 하지 말 것
    - **전형적인 면접 문제들에도 대비하지 않은 상태에서 면접장에 가지 말라**
    - 요구사항이나 가정들을 분명히 하지 않은 상태에서 설계를 제시하지 말라.
    - 처음부터 특정 컴포넌트의 세부사항을 깊게 설명하지 말라
    - 진행 중에 막혔다면, 힌트를 요청하라
    - 소통을 주저하지 말고, 침묵 속에서 설계를 진행하지 말라.
    - 설계를 내놓는 순간 면접이 끝난다고 생각하지 말라.
    -