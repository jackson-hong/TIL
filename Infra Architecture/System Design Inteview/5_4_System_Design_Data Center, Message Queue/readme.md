# 5/4 System Design Interview -

Date: May 4, 2022 12:43 PM

### 무상태(stateless) 웹 계층

- 웹 계층을 수평적으로 확장하기 위해 상태 정보는 웹 계층에서 제거해야한다.
- 웹 계층에서 상태 정보를 보관할 경우
    - 사용자 A의 정보를 서버 1이 가지고 있을 경우 사용자 A의 요청은 반드시 서버 1로 가야한다.
    - 이로인해 로드밸런서는 고정세션이라는 기능을 사용하게 되고 이는 로드밸런서에 부담을 준다.
    - 결론적으로 확장에 어려움이 생긴다.
- 웹 계층에서 상태 정보를 보관하지 않기 위해서
    - 공유 저장소(shared storage)로부터 상태를 가져온다 - 대표적으로 In-memory DB, NoSQL
    - 트래픽 양에 따라 웹서버를 넣거나 빼기가 쉬워진다.

### 데이터 센터

- 가용성을 높이고 전 세계 어디서도 쾌적하게 사용할 수 있게 해주는 아키텍쳐
- 장애가 없는 상황에서는 사용자와 가장 가까운 데이터 센터로 요청이 안내되는데 이를 geo-routing 이라고 한다.
- 데이터 센터 중 하나에 장애가 발생시 모든 트래픽은 장애가 없는 센터로 전송된다.
- 해결해야 할 문제
    - 트래픽 우회 : 올바른 데이터 센터로 트래픽을 보내기 위해 GeoDNS를 사용한다
    - 데이터 동기화 : 장애시 다른 데이터 센터로 트래픽이 몰려도 같은 데이터를 찾아올 수 있도록 데이터가 동기화되어야 한다.
    - 테스트와 배포 : 여러 데이터 센터에서 여러 위치에서 테스트를 해야한다. 자동 배포 도구는 이를 도와준다.

### 메시지 큐

- 메시지의 무손실을 보장하고 비동기 통신을 지원하는 컴포넌트다.
- 메시지 버퍼 역할을 하며 생산자가 메시지를 발행하고 그 큐에 발행하고 소비자는 메시지를 받는 동작을 수행한다.
- 메시지 큐를 이용하면 서비스 또는 서버 간 결합이 느슨해져서, 규모 확장성이 보장된다.

### 로그, 메트릭 그리고 자동화

- 로그
    - 에러 로그를 모니터링하는 것은 중요하므로 서버단위로 모니터링하기 보다는 단일 서비스로 모아주는 도구를 활용하면 더 편리하게 검색할 수 있다.
- 메트릭
    - 호스트 단위 메트릭 : CPU, Memory, Disk I/O에 관한 메트릭
    - 종합 메트릭 : DB 계층의 성능, 캐시 계층의 성능 등
    - 핵심 비지니스 메트릭 : 일별 능동 사용자, 수익, 재방문 등등
- 자동화
    - CI 툴을 이용해 코드의 검증 절차, 빌드, 테스트, 배포등을 자동화하여 개발 생산성을 크게 향상시킨다.