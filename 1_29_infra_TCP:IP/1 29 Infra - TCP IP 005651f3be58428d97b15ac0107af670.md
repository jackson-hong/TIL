# 1/29 Infra - TCP/IP

### 전송 계층 프로토콜 TCP

- 커널 내에서 통신 대상에게 전달하기 위한 준비 : 첫번째 TCP
- **신뢰도 높은 데이터 전송**을 가능케 한다
- 상대 서버까지 **전송하는 부분은 모두 IP에게 위임**한다
- IP에는 데이터가 상대방에게 **확실히 전달 됐는지**, **순서가 맞는지 확인하는 기능**이 없다
- 통신 정체가 발생하면 TCP가 통신 속도를 자동으로 내린다
- TCP 처리 흐름
    - 애플리케이션은 소켓의 큐를 경유하여 **소켓의 버퍼로 불리는 메모리 영역**에서 처리된다
    - 이후의 IP나 이더넷 처리도 소켓의 버퍼내에서 이뤄진다
    - TCP는 데이터를 **세그먼트**라는 단위로 나누어 링크 계층에 전송한다
    - 세그먼트의 최고 크기를 MSS(Max Segment Size)부르며 초과할 시 분할되어 복수의 세그먼트가 생성된다
    - 세그먼트로 나뉜다 = **헤더를 이용하여 데이터를 나눈다**
    - **| 헤더 | 데이터 | 헤더 | 데이터 |**
    - 헤더에는 출발지 포트, 목적지 포트, 시퀀스 번호, ACK 번호 등등 여러 정보가 담긴다
    - TCP는 포트번호를 사용하여 어떤 애플리케이션에 데이터를 전달할지 판단한다
- 연결 생성 (**3-way handshaking**)
    - TCP가 통신을 시작하면 상대에게 가상 경로를 열도록 의뢰한다 (1)
    - 서버측에 LISTEN 하고 있는 포트 번호로 통신 요구가 오고 열어도 된다는 응답을 한다 (2)
    - 클라이언트측도 확인이 됐다는 메세지를 전송한다 (3)
    
    ** 참고로 클라이언트 측에서 요청을 할 때 OS에 의해 지정된 포트번호를 사용하여 요청을 시작된다